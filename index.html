<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Santa's Midnight Dash</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at top, #0b1d3a, #02030a);
  overflow: hidden;
  font-family: system-ui, sans-serif;
}
canvas {
  display: block;
}
#ui {
  position: fixed;
  top: 12px;
  left: 12px;
  color: white;
  font-size: 16px;
  text-shadow: 0 2px 6px black;
}
#title {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 48px;
  background: radial-gradient(circle at center, rgba(10,30,70,0.9), rgba(0,0,0,0.95));
  cursor: pointer;
}
</style>
</head>
<body>

<div id="ui"></div>
<div id="title">ðŸŽ„ Santaâ€™s Midnight Dash ðŸŽ„<br><small>Click to Start</small></div>
<canvas id="game"></canvas>

<script>
/* =========================
   CORE ENGINE
========================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");
const titleScreen = document.getElementById("title");

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize", resize);
resize();

let last = 0;
let started = false;
let shake = 0;

function rand(a,b){return Math.random()*(b-a)+a}
function clamp(v,a,b){return Math.max(a,Math.min(b,v))}
function easeOut(t){return 1-Math.pow(1-t,3)}

/* =========================
   INPUT
========================= */
const keys = {};
addEventListener("keydown",e=>keys[e.code]=true);
addEventListener("keyup",e=>keys[e.code]=false);

/* =========================
   PARTICLES
========================= */
const particles = [];
function spawnParticle(x,y,c,life,size,vy=0){
  particles.push({x,y,vx:rand(-1,1),vy,life,max:life,c,size});
}

/* =========================
   PLAYER
========================= */
const player = {
  x: 200,
  y: 0,
  vy: 0,
  w: 40,
  h: 60,
  grounded: false,
  dash: 0
};

/* =========================
   WORLD
========================= */
let speed = 6;
let score = 0;
let combo = 1;
let ground = canvas.height - 120;
const obstacles = [];
const gifts = [];

/* =========================
   GENERATION
========================= */
function spawnObstacle(){
  obstacles.push({
    x: canvas.width + 50,
    y: ground,
    w: rand(40,70),
    h: rand(40,90)
  });
}
function spawnGift(){
  gifts.push({
    x: canvas.width + 50,
    y: ground - rand(120,220),
    r: 12
  });
}

/* =========================
   DRAWING
========================= */
function drawBackground(){
  ctx.fillStyle="#02030a";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // moon
  ctx.beginPath();
  ctx.arc(canvas.width-120,120,60,0,Math.PI*2);
  ctx.fillStyle="#fff6d5";
  ctx.fill();

  // parallax hills
  for(let i=0;i<3;i++){
    ctx.fillStyle=`rgba(20,40,80,${0.4-i*0.1})`;
    ctx.beginPath();
    ctx.moveTo(0,ground+60*i);
    for(let x=0;x<=canvas.width;x+=80){
      ctx.lineTo(x,ground+60*i+Math.sin((x+performance.now()/1000*(i+1))*0.01)*20);
    }
    ctx.lineTo(canvas.width,canvas.height);
    ctx.lineTo(0,canvas.height);
    ctx.fill();
  }
}

function drawSanta(){
  ctx.save();
  ctx.translate(player.x,player.y);
  ctx.fillStyle="#c00";
  ctx.fillRect(-player.w/2,-player.h,player.w,player.h);
  ctx.fillStyle="white";
  ctx.fillRect(-player.w/2,-player.h,player.w,8);
  ctx.restore();
}

/* =========================
   UPDATE
========================= */
function update(dt){
  speed += dt*0.00001;

  // gravity
  player.vy += 0.0012*dt;
  player.y += player.vy*dt;

  if(player.y >= ground){
    player.y = ground;
    player.vy = 0;
    player.grounded = true;
  } else player.grounded = false;

  // controls
  if(keys.ArrowUp && player.grounded){
    player.vy = -0.5;
    shake = 10;
  }
  if(keys.Space && player.dash<=0){
    player.dash = 200;
    shake = 20;
  }
  if(player.dash>0){
    player.dash -= dt;
  }

  // obstacles
  if(Math.random()<0.01) spawnObstacle();
  if(Math.random()<0.008) spawnGift();

  obstacles.forEach(o=>o.x -= speed*(player.dash>0?2:1));
  gifts.forEach(g=>g.x -= speed*(player.dash>0?2:1));

  // collisions
  obstacles.forEach(o=>{
    if(player.x+player.w/2>o.x && player.x-player.w/2<o.x+o.w &&
       player.y>o.y-o.h){
      reset();
    }
  });

  gifts.forEach((g,i)=>{
    if(Math.hypot(player.x-g.x,player.y-g.y)<30){
      score+=100*combo;
      combo++;
      shake=10;
      for(let j=0;j<20;j++) spawnParticle(g.x,g.y,"#ff0",500,2,-1);
      gifts.splice(i,1);
    }
  });

  // particles
  particles.forEach(p=>{
    p.life-=dt;
    p.x+=p.vx;
    p.y+=p.vy;
  });

  // cleanup
  while(obstacles.length && obstacles[0].x<-100) obstacles.shift();
  while(gifts.length && gifts[0].x<-100) gifts.shift();
  while(particles.length && particles[0].life<=0) particles.shift();

  score += dt*0.01;
  combo = Math.max(1,combo-0.001*dt);
}

/* =========================
   RENDER
========================= */
function render(){
  ctx.save();
  if(shake>0){
    ctx.translate(rand(-shake,shake),rand(-shake,shake));
    shake*=0.9;
  }

  drawBackground();

  // ground
  ctx.fillStyle="#ffffff";
  ctx.fillRect(0,ground,canvas.width,4);

  // gifts
  gifts.forEach(g=>{
    ctx.fillStyle="#0f0";
    ctx.beginPath();
    ctx.arc(g.x,g.y,g.r,0,Math.PI*2);
    ctx.fill();
  });

  // obstacles
  ctx.fillStyle="#333";
  obstacles.forEach(o=>ctx.fillRect(o.x,o.y-o.h,o.w,o.h));

  drawSanta();

  // particles
  particles.forEach(p=>{
    ctx.globalAlpha=p.life/p.max;
    ctx.fillStyle=p.c;
    ctx.fillRect(p.x,p.y,p.size,p.size);
    ctx.globalAlpha=1;
  });

  ctx.restore();

  ui.innerHTML = `
    Score: ${Math.floor(score)}<br>
    Combo: x${combo.toFixed(1)}
  `;
}

/* =========================
   LOOP
========================= */
function loop(t){
  const dt = t-last;
  last = t;
  update(dt);
  render();
  requestAnimationFrame(loop);
}

/* =========================
   RESET
========================= */
function reset(){
  obstacles.length=0;
  gifts.length=0;
  particles.length=0;
  score=0;
  combo=1;
  speed=6;
}

/* =========================
   START
========================= */
titleScreen.onclick = ()=>{
  titleScreen.style.display="none";
  started=true;
  reset();
  requestAnimationFrame(loop);
};
</script>
</body>
</html>
