<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Santa Rooftop Dash 3D</title>

<style>
html, body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: system-ui;
}

#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  color: white;
  font-size: 16px;
}
</style>
</head>

<body>
<div id="ui"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<script>
/* =====================
   CORE
===================== */
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x020611, 10, 120);

const camera = new THREE.PerspectiveCamera(70, innerWidth / innerHeight, 0.1, 200);
camera.position.set(0, 4, 9);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* =====================
   RESIZE
===================== */
addEventListener("resize", () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});

/* =====================
   LIGHTS
===================== */
scene.add(new THREE.AmbientLight(0x404080, 0.5));

const moon = new THREE.DirectionalLight(0xbfd9ff, 1.6);
moon.position.set(10, 20, -10);
moon.castShadow = true;
scene.add(moon);

/* =====================
   ROOFTOP PATH (GROUND)
===================== */
const ROOF_Y = 2.5;

const rooftopPath = new THREE.Mesh(
  new THREE.BoxGeometry(12, 0.5, 400),
  new THREE.MeshStandardMaterial({ color: 0xeaeaea })
);
rooftopPath.position.y = ROOF_Y - 0.25;
rooftopPath.receiveShadow = true;
scene.add(rooftopPath);

/* =====================
   PLAYER (SANTA)
===================== */
const santa = new THREE.Group();

const body = new THREE.Mesh(
  new THREE.BoxGeometry(1, 1.5, 0.8),
  new THREE.MeshStandardMaterial({ color: 0xcc0000 })
);

const head = new THREE.Mesh(
  new THREE.SphereGeometry(0.4, 24, 24),
  new THREE.MeshStandardMaterial({ color: 0xffddcc })
);
head.position.y = 1.2;

body.castShadow = head.castShadow = true;
santa.add(body, head);
santa.position.set(0, ROOF_Y, 0);
scene.add(santa);

/* =====================
   INPUT
===================== */
const keys = {};
addEventListener("keydown", e => keys[e.code] = true);
addEventListener("keyup", e => keys[e.code] = false);

/* =====================
   STATE
===================== */
let speed = 0.4;
let score = 0;
let combo = 1;

let yVelocity = 0;
let grounded = true;

/* =====================
   WORLD OBJECTS
===================== */
const decor = [];
const chimneys = [];
const gifts = [];

/* =====================
   HOUSE + CHIMNEY
===================== */
function createHouse(x, z) {
  const house = new THREE.Group();

  const base = new THREE.Mesh(
    new THREE.BoxGeometry(4, 3, 4),
    new THREE.MeshStandardMaterial({ color: 0x7a0c0c })
  );
  base.position.y = ROOF_Y - 2;
  base.castShadow = true;

  const roof = new THREE.Mesh(
    new THREE.BoxGeometry(4.4, 0.6, 4.4),
    new THREE.MeshStandardMaterial({ color: 0xffffff })
  );
  roof.position.y = ROOF_Y - 0.6;
  roof.castShadow = true;

  // ONE chimney per house
  const chimney = new THREE.Mesh(
    new THREE.BoxGeometry(0.8, 1.8, 0.8),
    new THREE.MeshStandardMaterial({ color: 0x333333 })
  );
  chimney.position.set(0, ROOF_Y + 0.6, 0);
  chimney.castShadow = true;

  house.add(base, roof);
  house.position.set(x, 0, z);

  scene.add(house);
  scene.add(chimney);

  decor.push(house);
  chimneys.push(chimney);

  // Chance for present above chimney
  if (Math.random() < 0.7) spawnGift(chimney.position.clone());
}

/* =====================
   PRESENT (CGI)
===================== */
function spawnGift(pos) {
  const gift = new THREE.Group();

  const box = new THREE.Mesh(
    new THREE.BoxGeometry(0.7, 0.7, 0.7),
    new THREE.MeshStandardMaterial({
      color: 0x00ff00,
      emissive: 0x006600
    })
  );

  const ribbon1 = new THREE.Mesh(
    new THREE.BoxGeometry(0.1, 0.8, 0.8),
    new THREE.MeshStandardMaterial({ color: 0xffd700 })
  );

  const ribbon2 = new THREE.Mesh(
    new THREE.BoxGeometry(0.8, 0.8, 0.1),
    new THREE.MeshStandardMaterial({ color: 0xffd700 })
  );

  gift.add(box, ribbon1, ribbon2);
  gift.position.copy(pos);
  gift.position.y += 1.5;

  scene.add(gift);
  gifts.push(gift);
}

/* =====================
   POPULATE WORLD
===================== */
for (let z = -20; z > -260; z -= 20) {
  createHouse(-6, z);
  createHouse(6, z);
}

/* =====================
   LOOP
===================== */
function animate() {
  requestAnimationFrame(animate);

  /* --- LANE MOVE --- */
  if (keys.ArrowLeft) santa.position.x -= 0.2;
  if (keys.ArrowRight) santa.position.x += 0.2;
  santa.position.x = THREE.MathUtils.clamp(santa.position.x, -4, 4);

  /* --- JUMP --- */
  if ((keys.Space || keys.ArrowUp) && grounded) {
    yVelocity = 0.5;
    grounded = false;
  }

  yVelocity -= 0.025;
  santa.position.y += yVelocity;

  if (santa.position.y <= ROOF_Y) {
    santa.position.y = ROOF_Y;
    yVelocity = 0;
    grounded = true;
  }

  /* --- WORLD SCROLL --- */
  [...decor, ...chimneys, ...gifts].forEach(obj => {
    obj.position.z += speed;
    if (obj.position.z > 10) obj.position.z -= 260;
  });

  /* --- CHIMNEY COLLISION --- */
  chimneys.forEach(c => {
    if (c.position.distanceTo(santa.position) < 1) {
      location.reload();
    }
  });

  /* --- GIFTS --- */
  gifts.forEach((g, i) => {
    g.rotation.y += 0.05;
    if (g.position.distanceTo(santa.position) < 1) {
      score += 100 * combo;
      combo += 0.5;
      scene.remove(g);
      gifts.splice(i, 1);
    }
  });

  combo = Math.max(1, combo - 0.005);
  score += 0.2;

  document.getElementById("ui").innerHTML =
    `Score: ${Math.floor(score)}<br>Combo: x${combo.toFixed(1)}`;

  camera.position.x += (santa.position.x - camera.position.x) * 0.08;
  camera.lookAt(santa.position.x, ROOF_Y + 0.5, 0);

  renderer.render(scene, camera);
}

animate();
</script>
</body>
</html>
