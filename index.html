<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Santa's Midnight Dash 3D</title>
<style>
html, body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: system-ui;
}

#overlay {
  position: fixed;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle, #0b1d3a, #000);
  z-index: 10;
  color: white;
}

#overlay h1 {
  font-size: 48px;
  margin-bottom: 20px;
}

#startBtn {
  font-size: 24px;
  padding: 14px 32px;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  background: linear-gradient(135deg, #ff4444, #cc0000);
  color: white;
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}

#startBtn:hover {
  transform: scale(1.05);
}

#ui {
  position: fixed;
  top: 10px;
  left: 10px;
  color: white;
}
</style>
</head>
<body>

<div id="overlay">
  <h1>üéÑ Santa‚Äôs Midnight Dash üéÑ</h1>
  <button id="startBtn">START GAME</button>
  <p style="opacity:.7">‚Üê ‚Üí Move</p>
</div>

<div id="ui"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<script>
/* =====================
   CORE SETUP
===================== */
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x020611, 10, 80);

const camera = new THREE.PerspectiveCamera(70, innerWidth / innerHeight, 0.1, 150);
camera.position.set(0, 3.5, 8);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
renderer.shadowMap.enabled = true;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.1;
document.body.appendChild(renderer.domElement);

/* =====================
   POST PROCESSING
===================== */
const composer = new THREE.EffectComposer(renderer);
composer.addPass(new THREE.RenderPass(scene, camera));
composer.addPass(
  new THREE.UnrealBloomPass(
    new THREE.Vector2(innerWidth, innerHeight),
    1.2, 0.4, 0.85
  )
);

addEventListener("resize", () => {
  camera.aspect = innerWidth / innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
  composer.setSize(innerWidth, innerHeight);
});

/* =====================
   LIGHTING
===================== */
scene.add(new THREE.AmbientLight(0x404080, 0.4));

const moon = new THREE.DirectionalLight(0xbfd9ff, 2);
moon.position.set(10, 20, -10);
moon.castShadow = true;
scene.add(moon);

/* =====================
   GROUND
===================== */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(300, 300),
  new THREE.MeshStandardMaterial({ color: 0xffffff })
);
ground.rotation.x = -Math.PI / 2;
ground.receiveShadow = true;
scene.add(ground);

/* =====================
   PLAYER (SANTA)
===================== */
const santa = new THREE.Group();

const body = new THREE.Mesh(
  new THREE.BoxGeometry(1, 1.5, 0.8),
  new THREE.MeshStandardMaterial({ color: 0xcc0000, emissive: 0x330000 })
);

const head = new THREE.Mesh(
  new THREE.SphereGeometry(0.4, 24, 24),
  new THREE.MeshStandardMaterial({ color: 0xffddcc, emissive: 0x331100 })
);
head.position.y = 1.2;

body.castShadow = head.castShadow = true;
santa.add(body, head);
santa.position.y = 1;
scene.add(santa);

/* =====================
   WORLD OBJECTS
===================== */
const scenery = [];
const obstacles = [];
const gifts = [];

function spawnTree(z) {
  const t = new THREE.Mesh(
    new THREE.ConeGeometry(0.8, 2.5, 8),
    new THREE.MeshStandardMaterial({ color: 0x0b5d1e })
  );
  t.position.set(rand(-10, 10), 1.25, z);
  t.castShadow = true;
  scene.add(t);
  scenery.push(t);
}

function spawnHouse(z) {
  const h = new THREE.Group();

  const base = new THREE.Mesh(
    new THREE.BoxGeometry(2, 1.5, 2),
    new THREE.MeshStandardMaterial({ color: 0x552200 })
  );

  const roof = new THREE.Mesh(
    new THREE.ConeGeometry(1.8, 1, 4),
    new THREE.MeshStandardMaterial({ color: 0x330000 })
  );
  roof.position.y = 1.25;
  roof.rotation.y = Math.PI / 4;

  const window = new THREE.Mesh(
    new THREE.PlaneGeometry(0.6, 0.6),
    new THREE.MeshStandardMaterial({
      color: 0xffffaa,
      emissive: 0xffff55
    })
  );
  window.position.set(0, 0, 1.01);

  base.castShadow = roof.castShadow = true;
  h.add(base, roof, window);

  h.position.set(rand(-12, 12), 0.75, z);
  scene.add(h);
  scenery.push(h);
}

function spawnObstacle() {
  const o = new THREE.Mesh(
    new THREE.BoxGeometry(1, rand(1, 2), 1),
    new THREE.MeshStandardMaterial({ color: 0x333333 })
  );
  o.position.set(rand(-4, 4), o.geometry.parameters.height / 2, -60);
  o.castShadow = true;
  scene.add(o);
  obstacles.push(o);
}

function spawnGift() {
  const g = new THREE.Mesh(
    new THREE.SphereGeometry(0.4, 16, 16),
    new THREE.MeshStandardMaterial({
      color: 0x00ff00,
      emissive: 0x00aa00
    })
  );
  g.position.set(rand(-4, 4), 1.5, -60);
  scene.add(g);
  gifts.push(g);
}

/* =====================
   INPUT
===================== */
const keys = {};
addEventListener("keydown", e => keys[e.code] = true);
addEventListener("keyup", e => keys[e.code] = false);

/* =====================
   GAME STATE
===================== */
let started = false;
let speed = 0.35;
let score = 0;
let combo = 1;

/* =====================
   MAIN LOOP
===================== */
function animate() {
  requestAnimationFrame(animate);

  // Always render (even before start)
  if (!started) {
    composer.render();
    return;
  }

  if (keys.ArrowLeft) santa.position.x -= 0.2;
  if (keys.ArrowRight) santa.position.x += 0.2;
  santa.position.x = THREE.MathUtils.clamp(santa.position.x, -5, 5);

  camera.position.x += (santa.position.x - camera.position.x) * 0.08;
  camera.lookAt(santa.position.x, 1.2, 0);

  if (Math.random() < 0.03) spawnTree(-100);
  if (Math.random() < 0.01) spawnHouse(-120);
  if (Math.random() < 0.02) spawnObstacle();
  if (Math.random() < 0.015) spawnGift();

  scenery.forEach((s, i) => {
    s.position.z += speed;
    if (s.position.z > 15) {
      scene.remove(s);
      scenery.splice(i, 1);
    }
  });

  obstacles.forEach((o, i) => {
    o.position.z += speed;
    if (o.position.z > 5) {
      scene.remove(o);
      obstacles.splice(i, 1);
    }
    if (o.position.distanceTo(santa.position) < 1) reset();
  });

  gifts.forEach((g, i) => {
    g.position.z += speed;
    g.rotation.y += 0.05;
    if (g.position.z > 5) {
      scene.remove(g);
      gifts.splice(i, 1);
    }
    if (g.position.distanceTo(santa.position) < 1) {
      score += 100 * combo;
      combo += 0.5;
      scene.remove(g);
      gifts.splice(i, 1);
    }
  });

  combo = Math.max(1, combo - 0.005);
  score += 0.2;

  document.getElementById("ui").innerHTML =
    `Score: ${Math.floor(score)}<br>Combo: x${combo.toFixed(1)}`;

  composer.render();
}

/* =====================
   RESET
===================== */
function reset() {
  [...scenery, ...obstacles, ...gifts].forEach(o => scene.remove(o));
  scenery.length = obstacles.length = gifts.length = 0;
  score = 0;
  combo = 1;
}

/* =====================
   START GAME
===================== */
function startGame() {
  document.getElementById("overlay").style.display = "none";
  started = true;
}

document.getElementById("startBtn").onclick = startGame;

/* =====================
   UTILS
===================== */
function rand(a, b) {
  return Math.random() * (b - a) + a;
}

/* =====================
   BOOTSTRAP LOOP
===================== */
requestAnimationFrame(animate);
</script>
</body>
</html>
